# Cassandra Configuration for AxonOps Metrics Storage
# Generated by Chef - Local modifications will be overwritten

cluster_name: '<%= @cluster_name %>'

num_tokens: 256

allocate_tokens_for_local_replication_factor: 3

hinted_handoff_enabled: true
max_hint_window: 3h
hinted_handoff_throttle: 1024KiB
max_hints_delivery_threads: 2
hints_flush_period: 10000ms
max_hints_file_size: 128MiB

authenticator: <%= @authenticator %>
authorizer: <%= @authorizer %>

partitioner: org.apache.cassandra.dht.Murmur3Partitioner

data_file_directories:
    - <%= @data_dir %>

commitlog_directory: <%= @commitlog_dir %>
saved_caches_directory: <%= @saved_caches_dir %>
hints_directory: <%= @hints_dir %>

commitlog_sync: periodic
commitlog_sync_period: 10000ms
commitlog_segment_size: 32MiB

seed_provider:
    - class_name: org.apache.cassandra.locator.SimpleSeedProvider
      parameters:
          - seeds: "<%= @seeds %>"

concurrent_reads: 32
concurrent_writes: 32
concurrent_counter_writes: 32
concurrent_materialized_view_writes: 32

disk_optimization_strategy: ssd

memtable_allocation_type: heap_buffers
memtable_flush_writers: 2

index_summary_capacity: 
index_summary_resize_interval: 60m

trickle_fsync: false
trickle_fsync_interval: 10240KiB

storage_port: 7000
ssl_storage_port: 7001

listen_address: <%= @listen_address %>
broadcast_address: 
listen_on_broadcast_address: false

start_native_transport: true
native_transport_port: 9042
native_transport_allow_older_protocols: true
rpc_address: <%= @rpc_address %>
broadcast_rpc_address:

rpc_keepalive: true

incremental_backups: false
snapshot_before_compaction: false
auto_snapshot: true
snapshot_links_per_second: 0

column_index_size: 64KiB
column_index_cache_size: 2KiB

compaction_throughput: 64MiB/s
sstable_preemptive_open_interval: 50MiB

read_request_timeout: 5000ms
range_request_timeout: 10000ms
write_request_timeout: 2000ms
counter_write_request_timeout: 5000ms
cas_contention_timeout: 1000ms
truncate_request_timeout: 60000ms
request_timeout: 10000ms

slow_query_log_timeout: 500ms

endpoint_snitch: GossipingPropertyFileSnitch

dynamic_snitch_update_interval: 100ms
dynamic_snitch_reset_interval: 600000ms
dynamic_snitch_badness_threshold: 1.0

internode_compression: dc
inter_dc_tcp_nodelay: false

tracetype_query_ttl: 86400
tracetype_repair_ttl: 604800

# AxonOps specific - minimal gc settings
gc_warn_threshold: 1000ms

enable_user_defined_functions: false
enable_scripted_user_defined_functions: false

windows_timer_interval: 1

# Reduced settings for metrics storage
max_hints_file_size: 128MiB
batch_size_warn_threshold: 5KiB
batch_size_fail_threshold: 50KiB

# Audit logging disabled for metrics storage
audit_logging_options:
    enabled: false