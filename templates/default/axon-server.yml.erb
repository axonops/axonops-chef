# AxonOps Server Configuration
# Generated by Chef - Local modifications will be overwritten

server:
  host: <%= @listen_address %>
  port: <%= @listen_port %>

<% if @use_new_format -%>
# New format for axon-server >= 2.0.4
search_db:
  hosts:
<% @search_db_hosts.each do |host| -%>
    - <%= host %>
<% end -%>
<% if @search_db_username -%>
  username: <%= @search_db_username %>
<% end -%>
<% if @search_db_password -%>
  password: <%= @search_db_password %>
<% end -%>
<% if @search_db_skip_verify -%>
  skip_verify: <%= @search_db_skip_verify %>
<% end -%>
<% if @search_db_replicas -%>
  replicas: <%= @search_db_replicas %>
<% end -%>
<% if @search_db_shards -%>
  shards: <%= @search_db_shards %>
<% end -%>
<% else -%>
# Old format for axon-server < 2.0.4
elastic_host: <%= @elastic_host %>
elastic_port: <%= @elastic_port %>
<% end -%>

cassandra:
  hosts:
<% @cassandra_hosts.each do |host| -%>
    - "<%= host %>"
<% end -%>
  username: "<%= @cassandra_username %>"
  password: "<%= @cassandra_password %>"
  dc: "<%= @cassandra_dc %>"

<% if @tls_mode != 'disabled' -%>
tls:
  mode: <%= @tls_mode %>
<% if @tls_cert_file -%>
  certFile: <%= @tls_cert_file %>
<% end -%>
<% if @tls_key_file -%>
  keyFile: <%= @tls_key_file %>
<% end -%>
<% if @tls_ca_file && @tls_mode == 'mTLS' -%>
  caFile: <%= @tls_ca_file %>
<% end -%>
<% end -%>

retention:
  events: <%= @retention['events'] %>
  security_events: <%= @retention['security_events'] %>
  
  metrics:
    high_resolution: <%= @retention['metrics']['high_resolution'] %>
    medium_resolution: <%= @retention['metrics']['medium_resolution'] %>
    low_resolution: <%= @retention['metrics']['low_resolution'] %>
    super_low_resolution: <%= @retention['metrics']['super_low_resolution'] %>
  
  backups:
    local: <%= @retention['backups']['local'] %>
    remote: <%= @retention['backups']['remote'] %>