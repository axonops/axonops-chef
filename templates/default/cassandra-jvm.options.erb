###########################################################################
#                             jvm-server.options                          #
#                                                                         #
# JVM server options for Cassandra                                        #
###########################################################################

# Heap size settings
-Xms<%= @heap_size %>
-Xmx<%= @heap_size %>
<% if @new_heap_size -%>
-Xmn<%= @new_heap_size %>
<% end -%>

# CMS Settings (pre-Java 9)
#-XX:+UseParNewGC
#-XX:+UseConcMarkSweepGC
#-XX:+CMSParallelRemarkEnabled
#-XX:SurvivorRatio=8
#-XX:MaxTenuringThreshold=1
#-XX:CMSInitiatingOccupancyFraction=75
#-XX:+UseCMSInitiatingOccupancyOnly
#-XX:CMSWaitDuration=10000
#-XX:+CMSParallelInitialMarkEnabled
#-XX:+CMSEdenChunksRecordAlways
#-XX:+CMSClassUnloadingEnabled

# GC Settings (Java 11+)
<% if node['axonops']['cassandra']['gc_type'] == 'G1GC' -%>
# G1 Garbage Collector
-XX:+UseG1GC
-XX:+ParallelRefProcEnabled
-XX:MaxGCPauseMillis=<%= node['axonops']['cassandra']['gc_g1_max_pause_millis'] %>
-XX:G1RSetUpdatingPauseTimePercent=<%= node['axonops']['cassandra']['gc_g1_rset_updating_pause_time_percent'] %>
<% elsif node['axonops']['cassandra']['gc_type'] == 'Shenandoah' -%>
# Shenandoah Garbage Collector
-XX:+UseShenandoahGC
-XX:ShenandoahGCHeuristics=<%= node['axonops']['cassandra']['gc_shenandoah_heuristics'] %>
<% if node['axonops']['cassandra']['gc_use_numa'] -%>
-XX:+UseNUMA
<% end -%>
<% end -%>

# GC logging options
-XX:+PrintGCDetails
-XX:+PrintGCDateStamps
-XX:+PrintHeapAtGC
-XX:+PrintTenuringDistribution
-XX:+PrintGCApplicationStoppedTime
-XX:+PrintPromotionFailure
-XX:+UseGCLogFileRotation
-XX:NumberOfGCLogFiles=10
-XX:GCLogFileSize=10M

# General JVM options
-XX:+AlwaysPreTouch
-XX:+DisableExplicitGC
-XX:+HeapDumpOnOutOfMemoryError
-XX:MaxDirectMemorySize=
-XX:+PerfDisableSharedMem
-XX:+UseCondCardMark

# Error handling
-XX:ErrorFile=<%= node['axonops']['cassandra']['directories']['gc_logs'] %>/hs_err_pid%p.log
-XX:HeapDumpPath=<%= node['axonops']['cassandra']['directories']['gc_logs'] %>

# Thread settings
-XX:+UseThreadPriorities
-XX:ThreadPriorityPolicy=42
